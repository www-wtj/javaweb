function InitObjs(n){attMouseEvent("upObjs"),$("div.obj span:last-child").each(function(){this.innerHTML.length>24&&$(this).attr("title",$(this).text())}),$("#upObjs div.obj td:first-child").each(function(){var t=$(this).attr("img");t==""?$(this).css("background-image","url(images/nopict.gif)"):t&&($(this).css("background-image","url(Thumb.ashx?src="+t+")"),$("<a href='UploadPicts/"+n+"/"+t+"' rel='cb'><img src='images/slide.png' title='幻灯' /><\/a>").appendTo(this))}),ColorBoxPhoto(),InitSortable()}function getContextDirID(){return srcObj.nextSibling.id.substr(1)}function getIdenEle(){return $(srcObj).parents("div")[0].lastChild}function chkEnter(){if(getKeyCode()==13){var n=getEventSrc();return n&&n.blur(),!1}return!0}function showBodyMenu(){var n=$(getEventSrc()),t,i;return n.is(".obj > span")&&(t=n.closest(".obj").addClass("temp"),i=within(n[0],getEvent()),t.removeClass("temp"),i)?(HideAllMenu(),!0):(HasPanelShowing()||($("#curDirId").val(curDirId),HideAllMenu(),$("#paste").css("display",$("#pasteSource").val()==""?"none":""),ShowPop("bodyMenu",!1)),CanelEvent())}function showObjMenu(){return HasPanelShowing()||(srcObj=getEventSrc(),$("#curDirId").val(getContextDirID()),HideAllMenu(),$("#cutDir,#delDir,#renameDir,#sep,#dirPower,#dirAttr").css("display",getIdenEle().getAttribute("adm")=="1"?"":"none"),ShowPop("dirMenu",!1)),CanelEvent()}function showObjItemMenu(){if(!HasPanelShowing()){srcObj=getEventSrc();var t=getIdenEle(),n=t.getAttribute("attr").split("|");$("#curObjItem").val(n[0]+"|"+n[1]),HideAllMenu(),$("#objMenu a[accesskey='D']").css("display",n[3]=="1"?"":"none"),$("#objMenu a[accesskey='X']").css("display",n[4]=="1"?"":"none"),$("#objMenu a[accesskey='E']").css("display",n[2]=="1"?"":"none"),$("#objMenu a[accesskey='N']").css("display",n[6]=="1"?"":"none"),$("#objMenu a[accesskey='C']").css("display",n[5]=="1"?"":"none"),$("#objMenu a[accesskey='B']").css("display",n[7]=="1"?"":"none"),ShowPop("objMenu",!1)}return CanelEvent()}function setContentHeight(){var n=$f("conArea"),r,t,u,i;n.onscroll=HideAllMenu,r=$f("PagerBar"),t=document.documentElement.clientHeight,r?(u=r.offsetHeight,i=t-u,n.style.height=i+"px",n.style.height=i-(n.offsetHeight-i)+"px"):(n.style.height=t+"px",n.style.height=t*2-n.offsetHeight+"px")}function toCart(){addToCart(getCurAttr("tid"),getCurAttr("rid"))}function toFav(){addToFav(getCurAttr("tid"),getCurAttr("rid"))}function doDefault(){return srcObj=getEventSrc(),$("#curDirId").val(getContextDirID()),openDir()}function openDir(){location="dir.aspx?admin=1&id="+getContextDirID()}function Search(n){location="dataHome.aspx?dirid="+(n==!0?curDirId:getContextDirID())}function add(){var t=document.createElement("div"),r,i,n;return t.className="obj dirbg",r=document.createElement("div"),t.appendChild(r),i=document.createElement("span"),t.appendChild(i),n=document.createElement("input"),n.type="text",n.id="newName",n.value="新建目录",n.onfocus=function(){this.select()},n.onblur=doAdd,n.onkeydown=chkEnter,i.appendChild(n),$f("upDirs").appendChild(t),$f("newName").focus(),!1}function doAdd(){var n=getEventSrc(),t;if(!n)return!1;if(t=$.trim(n.value),t=="")return n.focus(),!1;n.disabled="disabled",PageMethods.AddDir(t,curDirId,add_callback)}function add_callback(n){var t=$f("newName"),i,u,f,r;n.substr(0,1)=="D"?(i=t.parentNode.previousSibling,i.onmouseover=mover,i.onmouseout=mout,i.onclick=doDefault,i.oncontextmenu=showObjMenu,u=document.createTextNode(t.value),t.parentNode.setAttribute("id",n),t.parentNode.setAttribute("adm","1"),t.parentNode.replaceChild(u,t),parent.leftFrame.reloadTree(curDirId),f=$("#countDir").text(),$("#countDir").text(parseInt(f)+1)):(r=t.parentNode.parentNode,r.parentNode.removeChild(r),alert(n))}function renameDir(){var t=srcObj.nextSibling.firstChild,n=document.createElement("input");return n.type="text",n.id="newName",n.value=t.nodeValue,n.onfocus=function(){this.select()},n.onblur=doRenameDir,n.onkeydown=chkEnter,oriNameNode=t.cloneNode(!0),t.parentNode.replaceChild(n,t),$f("newName").focus(),!1}function doRenameDir(){var n=getEventSrc(),t;if(!n)return!1;if(n.value==oriNameNode.nodeValue)return n.parentNode.replaceChild(oriNameNode,n),!1;if(t=n.value.trim(),t=="")return n.focus(),!1;n.disabled="disabled",PageMethods.RenameDir(getContextDirID(),t,renameDir_callback)}function renameDir_callback(n){var t=$f("newName"),i;n==""?(i=document.createTextNode(t.value),t.parentNode.replaceChild(i,t),parent.leftFrame.reloadTree(curDirId)):(t.parentNode.replaceChild(oriNameNode,t),alert(n))}function doObjItemDefault(){srcObj=getEventSrc(),$(srcObj).is("td")&&openObj(!$.browser.isMobile)}function openObj(n){var t="detail.aspx?tid="+getCurAttr("tid")+"&rid="+getCurAttr("rid")+"&InSerial=true";return n==!0?toPopup(t):location=t,!1}function editObj(){return location="edit.aspx?tid="+getCurAttr("tid")+"&rid="+getCurAttr("rid"),!1}function openTemplet(){return location="viewObj.aspx?tid="+getCurAttr("tid"),!1}function setSource(n,t){t||(t="obj");var i;return i=t=="dir"?n+"|dir|"+getContextDirID():n+"|obj|"+getCurAttr("tid")+"|"+getCurAttr("rid"),$("#pasteSource").val(i),$.get("ajax.aspx",{pasteSource:i}),!1}function renameObj(){var t=getIdenEle(),n=document.createElement("input");return n.type="text",n.id="newName",n.value=t.innerHTML,n.onfocus=function(){this.select()},n.onblur=doRenameObj,n.onkeydown=chkEnter,oriNameNode=t.cloneNode(!0),t.innerHTML="",t.appendChild(n),$f("newName").focus(),!1}function doRenameObj(){var n=getEventSrc(),t;if(!n)return!1;if(n.value==oriNameNode.innerHTML)return n.parentNode.parentNode.replaceChild(oriNameNode,n.parentNode),!1;t=n.value.trim(),n.disabled="disabled",PageMethods.reIdenObjItem(getCurAttr("tid"),getCurAttr("rid"),t,renameObj_callback)}function renameObj_callback(n){var t=$f("newName");n==""?t.parentNode.innerHTML=t.value:(t.parentNode.parentNode.replaceChild(oriNameNode,t.parentNode),alert(n))}function getCurAttr(n){var i=getIdenEle(),t=i.getAttribute("attr").split("|");if(t.length!=8)return"";switch(n){case"tid":return t[0];case"rid":return t[1];case"edit":return t[2];case"del":return t[3];case"cut":return t[4];case"copy":return t[5];case"rename":return t[6];case"buy":return t[7];default:return""}}function showOnly(n){return __doPostBack("types",n),!1}function InitSortable(){$("#upDirs").sortable({items:"div.obj",handle:"div:first",helper:"clone",opacity:.7,ghosting:!1,scroll:!1,update:updateOrder}).find("div.obj").attr("title","点击打开，拖动调整位置")}function updateOrder(){var n="",t;$("#upDirs div.obj").each(function(){t=$(this).find("span:last-child").attr("id").substr(1),n+=t+","}),n.length>0&&(n=n.substr(0,n.length-1)),SaveDirOrder(n)}function SaveDirOrder(n){$.get("ajax.aspx",{action:"updateDirOrder",dir:curDirId,orders:n},function(){try{parent.leftFrame.reloadTree(curDirId)}catch(n){}})}function toSave(){return $("#p3_showing").length>0&&__doPostBack("p3$btnOK",""),!1}function attrShown(){$("#p3_showing").length==0&&$("#p3_btnCanel").hide()}function ClearTooltipCache(){$("td.ov").remove()}function toPopup(n){var t=document.documentElement.clientWidth-50,i=document.documentElement.clientHeight-18,r,u;parent&&(r=parent.document.getElementById("lr"),u=parent.document.getElementById("tb"),r&&r.cols!="0,*"&&(t+=258),u&&u.rows!="24,*"&&(i+=60)),t<600||i<360||inPopup()?location=n:$.colorbox({href:n,width:Math.min(t,998),height:Math.min(i,700)})}var srcObj,oriNameNode;$(function(){window.onresize=setContentHeight,document.oncontextmenu=showBodyMenu,document.onclick=HideAllMenu,document.onselectstart=HideAllMenu,document.onmouseout=function(n){n=n||event;var t=n.clientX>=0&&n.clientX<document.documentElement.clientWidth&&n.clientY>=0&&n.clientY<document.documentElement.clientHeight;t||HideAllMenu()},document.onkeydown=function(){var t=getEvent(),i,n;if($(t.srcElement||t.target).is("input"))return!0;i=t.keyCode||t.which,n=null;switch(i){case 37:case 33:n=$f("btnPrevious");break;case 39:case 34:n=$f("btnNext");break;case 36:n=$f("btnFirst");break;case 35:n=$f("btnLast")}return n&&!n.disabled?(__doPostBack(n.id,""),!1):!0},$("#ov,#objMenu").mouseover(function(){$("#upObjs .obj td a").hide()}),setContentHeight(),$("body").removeClass("waiting");var n=Sys.WebForms.PageRequestManager.getInstance();n.add_initializeRequest(showLoading),n.add_endRequest(hideLoading)})