function initEditInPlace(){$("#p_popup").length>0&&typeof editable!="undefined"&&editable!=null&&editable.length>0&&($("#body [fid]").each(function(){editable.indexOf("|"+$(this).attr("fid")+"|")>-1?$(this).dblclick(function(){$("#curFieldId").val($(this).attr("fid"));var n="",t=$("span[code]",this);return t.length>0&&(n=t.attr("code")),showLoading(),__doPostBack("btnTrigger",n),CanelEvent()}).attr("title",$(this).is("td")?"双击该单元格可就地编辑":"双击此处可就地编辑"):$(this).dblclick(function(){ShowMsgPop("您当前双击的字段不可编辑！")})}),$("#body td.val:not([fid])").dblclick(function(){$(this).has("table[editable]")||ShowMsgPop("您当前双击的单元格不能被编辑！")})),$("#body table[editable]").each(function(){var t=$(this).attr("editable"),n=eval("["+t+"]");$("tr[rid] > td",this).each(function(){n[this.cellIndex]>0?$(this).dblclick(function(){$("#curFieldId").val(n[this.cellIndex]);var t=$(this.parentNode).attr("rid"),i=$("span[code]",this);return i.length>0&&(t+=i.attr("code")),showLoading(),__doPostBack("btnTrigger",t),$(this).closest("tr[rid]").css("background-color","#ffffff").animate({backgroundColor:"#ff4411"},700,function(){$(this).animate({backgroundColor:"#ffffff"},700,function(){$(this).css("background-color","")})}),$("#body table.processing").removeClass("processing"),$(this).closest("table[editable]").addClass("processing"),CanelEvent()}).attr("title","双击该单元格可就地编辑"):$(this).dblclick(CanelEvent)})}),ColorBoxPhoto()}function updateEditor(){needUpdateEditor&&UpdateEditorElement("p__ck")}function pagerChanged(){try{var n=$("#ddlPager").val().split("|");location=location.href.replace(/tid=\d+\b/,"tid="+n[0]).replace(/rid=\d+\b/,"rid="+n[1])}catch(t){}}function checkEnter(){var n=getKeyCode();return n==13?(setTimeout(function(){$("#p_btnOK").click()},0),!1):!0}function update(n,t,i){var r,f,u,o,e,s;if(i=DeBase64(i),r=null,t==null)r=$("[fid='"+n+"']");else for(f=$("table[editable]"),u=0;u<f.length;u++)o=$(f[u]).attr("editable"),new RegExp("(^|,)"+n+"($|,)").test(o)&&(e=$("tr[rid='"+t+"']",f[u]),e.length>0&&(s=eval("["+o+"]"),r==null?r=$(e[0].cells[s.indexOf(n)]):r.add(e[0].cells[s.indexOf(n)])));if(r==null){alert("意外错误：找不到就地编辑的源元素！");return}r.html(i).hide().fadeIn("slow"),i.indexOf("ui-tabs")>-1&&$(".ui-tabs",r).tabs().show(),ColorBoxPhoto(),top.detailChanged=!0,(popFrom("viewdata.aspx")||popFrom("detail.aspx"))&&(parent.dataChanged=!0),hideLoading()}function delConf(){return confirm("确定要删除吗？")?(popFrom("viewdata.aspx")&&(parent.dataChanged=!0),!0):!1}function reloadPage(){top.detailChanged=!0,showLoading();var t=location.href+"&timeStamp="+(new Date).getTime(),n=$("#ifr");n.length==0?n=$("<iframe frameborder='0' id='ifr' name='ifr' src='"+t+"' style='width:0;height:0;display:none' />").appendTo("body").on("load",function(){var t=$(".ui-tabs:first").tabs("option","active"),i=n[0].contentWindow;i.$(".ui-tabs:first").tabs({active:t}),$("#body").html(i.$("#body").html()),hideLoading(),initEditInPlace(),$(".ui-tabs:first").tabs({active:t}).show().css("opacity","1"),$(".ui-tabs:gt(0)").tabs().show().css("opacity","1")}):n.attr("src",t)}function toPopup(n){var t=document.documentElement.clientWidth-50,i=document.documentElement.clientHeight-18,r,u;return parent&&(r=parent.document.getElementById("lr"),u=parent.document.getElementById("tb"),r&&r.cols!="0,*"&&(t+=258),u&&u.rows!="24,*"&&(i+=60)),t<600||i<360||inPopup()?location=n.href:$.colorbox({href:n.href,width:Math.min(t,980),height:Math.min(i,700),overlayClose:!1,onClosed:function(){typeof dataChanged!="undefined"&&dataChanged==!0&&(reloadPage(),dataChanged=null)}}),!1}function MarkAndBack(){top.detailChanged==!0&&(referrerIs("viewdata.aspx")?top.needRefreshTable=!0:referrerIs("overview.aspx")&&(top.needRefreshOverview=!0)),top.detailChanged=null,inPopup()&&!referrerIs("detail.aspx")?parent.$.colorbox.close():history.go(-1)}function ProcessForExportAs(n,t){n.find("[title],[fid],[rel],[onclick],[onerror]").removeAttr("title target fid rel onclick onerror"),t=="doc"&&n.find("div.imgBlock").each(function(){var n=$(this).css("background").toLowerCase(),t=n.indexOf("thumb.ashx"),i=n.indexOf(")");t<0||i<0||(n=n.substring(t,i-1),$(this).removeClass("imgBlock").append("<img src='"+n+"' />"))})}function toLayout(){location=location.href.replace(/detail\.aspx/i,"detailLayout.aspx")}function delConf(){return confirm("确定要删除当前编辑的这一行数据吗？")}function RowDeleted(n){HideDialog("p_popup"),$("table.processing tr[rid='"+n+"']").css("background-color","#ffffff").animate({backgroundColor:"#ff4411"},400,function(){$(this).animate({backgroundColor:"#ffffff"},400,function(){$(this).remove()})})}function toAdd(n){return HideDialog(),toPopup(n)}function showMenu(){var i=$("#btnLayout"),n=i.offset(),t=n.top,r=$("#layouts").outerHeight();t+r>document.documentElement.clientHeight&&(t=n.top+i.height()-r+4),$("#layouts").css({left:n.left,top:t,display:"none"}).fadeIn("fast")}var needUpdateEditor=!1;$(function(){if($(".ui-tabs").tabs().show(),top.needRefreshDetail==!0&&(top.needRefreshDetail=null,location.reload(!0)),inPopup()&&($("html#detail").addClass("inpopup"),$("a[href^='view.aspx']").click(function(){return parent.$.colorbox.close(this.href),!1})),$("#l input[type='image']:enabled").click(function(){try{var n=$(this).attr("objIndex").split("|");location=location.href.replace(/tid=\d+\b/,"tid="+n[0]).replace(/rid=\d+\b/,"rid="+n[1])}catch(t){}return!1}),$(document).click(function(){var n=$(getEventSrc());n.is("#btnLayout")||HideAllMenu()}).keydown(function(){var t,i,n;if($("#p_popup").is(":visible")||(t=getEvent(),$(t.srcElement||t.target).is("input")))return!0;i=t.keyCode||t.which,n=null;switch(i){case 37:case 33:n=$f("btnPrevious");break;case 39:case 34:n=$f("btnNext");break;case 36:n=$f("btnFirst");break;case 35:n=$f("btnLast")}return n&&!n.disabled?($(n).click(),!1):!0}),$("#btnExport").length==0&&(document.oncontextmenu=function(){return $(getEventSrc()).is(":input")?!0:CanelEvent()},document.documentElement.oncopy=function(){return $.browser.msie?$(getEventSrc()).is(":input,td,p"):getSelection().toString().indexOf(String.fromCharCode(9))==-1}),initEditInPlace(),$("#main").length>0){var n=($(window).width()-20)*.97;$("table,img","#main").each(function(){if($(this).width()>n)return $("html").css("overflow-x","auto"),!1})}})