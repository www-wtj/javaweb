function tab(n,t){var i,u,r;t||(n==5&&$f("t4")==null&&(n=4),n>1&&$f("t1")==null&&n--),i=$("#tabs").tabs("option","active")==n,u=tabFixed&&i,u||(tabFixed=!1),i||($("#tabs").tabs({active:n}),$("#tabs .ui-tabs-nav a.on").text("").removeClass("on"),n>0&&(r=$("#tabs .ui-tabs-nav li").eq(n).find("a")[0],$(r).text(r.title).addClass("on")),$("#tabs .ui-tabs-nav a.linked").removeClass("linked"))}function Init(){$("#tabs").length>0&&($("#tabs").tabs().show().find(".ui-tabs-panel").click(function(){!tabFixed&&$(getEventSrc()).is("a[href*='.aspx'],a[href*='.aspx'] img")&&tab(0)}),$("#tabs ul:first a").click(function(){tabFixed||this.id=="t0"?toLoad($(this).attr("rev")):(tabFixed=!0,$(this).addClass("linked"),document.documentElement.scrollHeight>document.documentElement.clientHeight&&$(".item .bgu").click())}),curTabIndex>0&&(tab(curTabIndex,!0),$("#tabs .ui-tabs-nav li").eq(curTabIndex).find("a").click()),$(document).mouseout(function(n){if(tabFixed||!pageLoaded||(n=n||event,$(n.srcElement||n.target).is("select,option")))return!0;within($f("tabs"),n)||tab(0)})),$(".item .title").click(function(){$(this).next(".taskArea").slideToggle("slow"),$(this).toggleClass("bgu"),$(this).toggleClass("bgd")}).hover(function(){$(this).addClass("titleHover")},function(){$(this).removeClass("titleHover")}),$("#tabs .ui-tabs-panel li a[href*='.aspx']").each(function(){this.href="to.htm?"+this.href}),SetDirLink()}function ddlChanged(n){var u=getEventSrc(),t=$(u).val(),i,r;t.indexOf("|")>-1?(t=t.split("|"),i=t[0],r=t[1],i>0?toLoad("detail.aspx?tid="+i+"&rid="+r):toLoad("info.aspx?id="+r)):toLoad(n+t),u.selectedIndex=0,tab(0)}function cboxShowing(){return parent.mainFrame.$&&parent.mainFrame.$("#cboxWrapper").is(":visible")}function setLeftBar(n){parent.document.getElementById("lr").cols=n?"258,*":"0,*",leftShown=null}function refresh(){var u=parent.document.getElementById("lr").cols!="0,*",n,t,i,r,f;if($(self.frameElement).is("frame#leftFrame")&&(parent.topFrame&&parent.topFrame.topShown!=null&&!cboxShowing()&&parent.topFrame.topShown!=parent.topFrame.topBarShown()&&parent.topFrame.setTopBar(parent.topFrame.topShown),leftShown==null||leftShown==u||cboxShowing()||setLeftBar(leftShown)),u){n=parent.mainFrame;try{t=n.location.href}catch(e){setTimeout("refresh();",1e3);return}t=getFilename(t),$("#CurrentInfo").length>0&&(t=="dir.aspx"?$("#liTitle").addClass("hide"):($("#liTitle").removeClass("hide"),$("#curTitle").html(n.document.title)),$("#ulDetail").html($("#fixedInfo").html()),i=n.document.getElementById("AttributeInfo"),i&&($f("ulDetail").innerHTML+=$(i).html())),$("#Views").length>0&&(n.views!=null&&typeof n.views!="undefined"?($("#Views").show(),$("#Views li").each(function(){n.views.indexOf(this.id.substr(1,1))>-1?$(this).show().attr("title","切换到"+$("a:first",this).text()+"进行查看"):$(this).hide()})):($("#Views li").each(function(){this.title="以"+$("a:first",this).text()+"查看最近浏览的数据"}),$("#Views,#v1,#v3,#v4").show())),$("#Dirs").length>0&&($("#Dirs a.current").removeClass("current"),t=="dir.aspx"&&(r=n.location.href,f=r.substr(r.lastIndexOf("id=")+3).toLowerCase(),$("#Dirs a.d_0[href$='?id="+f+"']").addClass("current"))),$.browser.msie&&parseInt($.browser.version)<7&&$("body").css("margin-right",document.documentElement.scrollHeight>document.documentElement.clientHeight?"21px":"")}setTimeout("refresh();",1500)}function getFilename(n){return n.indexOf("?")>-1&&(n=n.substr(0,n.indexOf("?"))),n.substr(n.lastIndexOf("/")+1).toLowerCase()}function SetDirLink(){var n;$("#d a").each(function(){if(n=$(this).attr("href"),n.indexOf("javascript:")==0)$(this).attr("target","_self");else{var t=n.split("/");this.href="to.htm?dir.aspx?id="+t[t.length-1]}}),$("#tabs .tree a").each(function(){if(n=$(this).attr("href"),n!=null&&typeof n!="undefined")if(n.indexOf("javascript:")==0)$(this).attr("target","_self");else{var t=n.split("/");this.href="to.htm?"+this.href}})}function reloadTree(n){$("#Dirs").length>0&&(curTabIndex=$("#tabs").tabs("option","active"),n==null&&(n=0),__doPostBack("btnReload",n))}function reloadTabs(n){$("#Starts").length>0&&(curTabIndex=$("#tabs").tabs("option","active"),__doPostBack("btnReload",n))}function reloadAll(){curTabIndex=$("#tabs").tabs("option","active"),__doPostBack("btnReload","")}function InitForLayout(n){for(var t=0;t<n[0].length;t++)$("#"+n[0][t]).appendTo("#inMain");for(t=0;t<n[1].length;t++)$("#"+n[1][t]).appendTo("#inOther");BlockMoved(),$("a","#inMain,#inOther").click(CanelEvent),$("#inMain,#inOther").sortable({connectWith:"#inMain,#inOther",items:"div.item",helper:"clone",opacity:.7,ghosting:!1,scroll:!1,update:BlockMoved}).find("div.item").attr("title","用鼠标拖动调整该模块的位置")}function BlockMoved(){$("#inMain,#inOther").each(function(){$("div.item",this).length>0?$("div.padBlock",this).hide():($("div.padBlock",this).length==0&&$("<div class='padBlock'>可将模块拖入此处！<\/div>").appendTo(this),$("div.padBlock",this).show())})}function PreAddBlock(){return $.trim($("#tbTitle").val())!=""?!0:(alert("必须输入模块标题！"),!1)}function PreAddEle(){if($("#addEle_ddlTypes").val()=="Html"){var n=CKEDITOR.instances.addEle_tbHtml;if(n!=null&&(n.updateElement(),n.getData()==""))return alert("必须输入内容！"),!1}return!0}function delBlock(n){return $("#"+n).slideUp(function(){$(this).remove(),BlockMoved()}),__doPostBack("btnHelper",n),!1}function SelectedDir(n){__doPostBack("addEle$selectDir",n)}function InitAddPop(){MakeEditor("#addEle_tbHtml","Normal","150px",!1,!1),typesChanged()}function typesChanged(){$("#addEle_Body *[for]").addClass("hide");var n=$("#addEle_ddlTypes").val();$("#addEle_ddlTypes").next().css("display",n==""?"none":""),$("#addEle_Body *[for='"+n+"']").removeClass("hide")}function BlockAdded(n){var t=$("#inCustom").clone();t.find(".title:first").html("<span><\/span><a href='#' title='删除模块' class='delIcon' onclick=\"return delBlock('"+n+"');\">×<\/a>"+$("#tbTitle").val()),$("#cmds",t).remove(),$("#ulEles",t).attr("id","ul_"+n),t.attr("id",n).hide().appendTo("#inOther").fadeIn(function(){$(this).removeAttr("style")}),$(".title",t).click(function(){$(this).next(".taskArea").slideToggle("slow"),$(this).toggleClass("bgu"),$(this).toggleClass("bgd")}).hover(function(){$(this).addClass("titleHover")},function(){$(this).removeClass("titleHover")}),BlockMoved(),$("a",t).click(CanelEvent)}function PreSave(n){var t="",i;if(idsOther="",$("#inMain div.item").each(function(){t+=this.id+","}),t=="")return alert("预览区必须至少保留一个模块！"),!1;$("#inOther div.item").each(function(){idsOther+=this.id+","}),i=t+"|"+idsOther,__doPostBack(n.id,i)}var leftShown=null,tabFixed=!1,curTabIndex=0;$(function(){Init(),$("#close").attr("title","关闭侧栏").click(function(){try{parent.topFrame.leftright()}catch(n){}}).hover(function(){$(this).addClass("over")},function(){$(this).removeClass("over")}),$("#diy").attr("title","自定义侧栏").click(function(){try{parent.mainFrame.location="sidebar.aspx?layout=true"}catch(n){}}).hover(function(){$(this).addClass("over")},function(){$(this).removeClass("over")}),refresh(),setInterval(function(){$.get("ajax.aspx").complete(function(n){n=null})},114e4),$(window).load(function(){setTimeout(function(){$("<iframe frameborder='0' id='preload' name='preload' src='preload.aspx' style='width:0;height:0;display:none' />").appendTo("body"),$.get("ajax.aspx",{action:"getReleaseTime"},function(n){try{new Date(n)>new Date(releaseTime)&&(window.frames.preload.location.reload(!0),parent.mainFrame.ShowMsgPop("<p>检测到系统已更新，请清空浏览器缓存（Internet临时文件）！<\/p>",6e4))}catch(t){}})},2500)})})