function AttObjEvent(){attMouseEvent("objsDiv"),setContentHeight(),$("#objsDiv").bind("contextmenu",showBodyMenu)}function getNameFromObj(){return srcObj.nextSibling.innerHTML}function getCurUnitID(){return srcObj.nextSibling.id.substr(1)}function chkEnter(){var n=getEvent(),t=n.srcElement||n.target,i=n.keyCode||n.which;return i==13?(t.blur(),!1):!0}function chkEnterForSearch(){var n=getEvent(),t=n.keyCode||n.which;return t==13?(searchUser(),!1):!0}function setContentHeight(){var n=$f("objsDiv"),t;n.onscroll=HideAllMenu,t=document.documentElement.clientHeight-60,n.offsetHeight<t&&(n.style.height=t+"px")}function showObjMenu(n){n=n||event;var t=n.srcElement||n.target;return HasPanelShowing()||(srcObj=t,$f("curUserName").value=getNameFromObj(),HideAllMenu(),ShowPop("menu_obj")),n.cancelBubble=!0,!1}function showUnitMenu(n){n=n||event;var t=n.srcElement||n.target;return HasPanelShowing()||(srcObj=t,$f("curUnit").value=getCurUnitID(),HideAllMenu(),ShowPop("menu_unit")),n.cancelBubble=!0,!1}function showBodyMenu(n){var t,i,r;return(n=n||event,t=$(n.srcElement||n.target),t.is(".obj > span")&&(i=t.closest(".obj").addClass("temp"),r=within(t[0],getEvent()),i.removeClass("temp"),r))?(HideAllMenu(),!0):(HasPanelShowing()||(HideAllMenu(),$("#paste").css("display",$("#objsDiv").attr("paste")=="1"?"":"none"),ShowPop("menu_body")),n.cancelBubble=!0,!1)}function doDefault(n){n=n||event,srcObj=n.srcElement||n.target,$(srcObj.parentNode).is(".unitbg")?($("#curUnit").val(getCurUnitID()),ShowUnit()):($f("curUserName").value=getNameFromObj(),__doPostBack("showAttributes",""))}function del(){if(!confirm("确定要删除该用户吗？"))return!1;var n;try{n=getNameFromObj()}catch(t){return alert("操作失败！"),!1}return PageMethods.delUser(n,delUser_callback),!1}function delUser_callback(n){if(n==""){var t=srcObj.parentNode;t.parentNode.removeChild(t),$f("updateUsersCount").click()}else alert("删除失败：\n"+n)}function searchUser(){var n=$f("keyword").value.replace(/(^\s*)|(\s*$)/g,"");return n==""?!1:(location="users.aspx?key="+encodeUrl(n),!1)}function createUser(){var t,r,i,n;return typeof noInitUserData!="undefined"&&noInitUserData!=null&&noInitUserData==!0?(confirm("尚未设置默认用户信息！\n要添加新用户，必须先设置默认的用户信息！\n\n是否现在就进行此设置？")&&(location="reg.aspx?mode=init"),!1):(t=document.createElement("div"),t.className="obj userbg",r=document.createElement("div"),t.appendChild(r),i=document.createElement("span"),t.appendChild(i),n=document.createElement("input"),n.type="text",n.id="newName",n.value="新建用户",n.onfocus=function(){this.select()},n.onblur=doCreateUser,n.onkeydown=chkEnter,i.appendChild(n),$f("objsDiv").appendChild(t),$f("newName").focus(),!1)}function doCreateUser(){var t=getEvent(),n,i;if(t==null)return!1;if(n=t.srcElement||t.target,i=$.trim(n.value),i=="")return n.focus(),!1;n.disabled="disabled",PageMethods.addUser(i,curUnitId,typeof curRole=="undefined"?null:curRole,createUser_callback)}function createUser_callback(n){var t=$f("newName"),i,u,r;n==""?(i=t.parentNode.previousSibling,i.onmouseover=mover,i.onmouseout=mout,i.onclick=doDefault,i.oncontextmenu=showObjMenu,u=document.createTextNode(t.value),t.parentNode.replaceChild(u,t),$f("updateUsersCount").click()):(r=t.parentNode.parentNode,r.parentNode.removeChild(r),alert(n))}function createUnit(){var t=document.createElement("div"),r,i,n;return t.className="obj unitbg",r=document.createElement("div"),t.appendChild(r),i=document.createElement("span"),t.appendChild(i),n=document.createElement("input"),n.type="text",n.id="newName",n.value="新建机构",n.onfocus=function(){this.select()},n.onblur=docreateUnit,n.onkeydown=chkEnter,i.appendChild(n),$f("objsDiv").appendChild(t),$f("newName").focus(),!1}function docreateUnit(){var t=getEvent(),n,i;if(t==null)return!1;if(n=t.srcElement||t.target,i=$.trim(n.value),i=="")return n.focus(),!1;n.disabled="disabled",PageMethods.addUnit(i,curUnitId,createUnit_callback)}function createUnit_callback(n){var t=$f("newName"),i,u,r;n.substr(0,1)=="D"?(i=t.parentNode.previousSibling,i.onmouseover=mover,i.onmouseout=mout,i.onclick=doDefault,i.oncontextmenu=showUnitMenu,u=document.createTextNode(t.value),t.parentNode.setAttribute("id",n),t.parentNode.replaceChild(u,t),reloadUnitTree()):(r=t.parentNode.parentNode,r.parentNode.removeChild(r),alert(n))}function reloadUnitTree(){__doPostBack("refreshTree","")}function cut(n){var t;return t=n=="Unit"?"Unit_"+getCurUnitID():"User_"+getNameFromObj(),$.get("ajax.aspx",{ToCut:t}),!1}function ShowUnit(){var n=$("#divUnits a[title='"+$("#curUnit").val()+"']:first");n.click(),eval(n.attr("href"))}function delUnit(){return confirm("确定要删除该机构吗？")}function ShowSearch(){ShowPop("popSearch_popup",!0),$f("keyword").focus()}function setManagedUnitsArea(){$("#attr_managed").css("display",$("#attr_cbRector").is(":checked")?"none":"")}var curUnitId=0,srcObj;$(function(){window.onresize=setContentHeight;var n=Sys.WebForms.PageRequestManager.getInstance();n.add_initializeRequest(showLoading),n.add_endRequest(hideLoading)}),document.onclick=HideAllMenu,document.onscroll=HideAllMenu,document.onselectstart=HideAllMenu,document.onmouseout=function(n){n=n||event;var t=n.clientX>=0&&n.clientX<document.documentElement.clientWidth&&n.clientY>=0&&n.clientY<document.documentElement.clientHeight;t||HideAllMenu()}